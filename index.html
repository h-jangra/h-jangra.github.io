<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HJangra</title>
  <link href="style.css" rel="stylesheet" />
</head>

<body>
  <header>
    <nav>
      <ul>
        <li> <a href="#">Home</a></li>
        <li> <a href="https://github.com/h-jangra" target="_blank">GH</a></li>
      </ul>
    </nav>
  </header>
  <main id="content">
    <section id="portfolio">
      <h2>Portfolio</h2>
      <div class="projects">
        <div class="project-card">
          <h3>Project One</h3>
          <p>Short description of project. Built with React & Tailwind.</p>
        </div>
        <div class="project-card">
          <h3>Project Two</h3>
          <p>Something about this one. Built in Python & Flask.</p>
        </div>
        <div class="project-card">
          <h3>Project Three</h3>
          <p>Portfolio site itself, built in vanilla HTML, CSS, JS.</p>
        </div>
      </div>
    </section>

  </main>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/4.3.0/marked.min.js"></script>
  <script>
    let blogs = [];
    const content = document.getElementById("content");
    const maxVisible = 4;

    async function loadBlogList() {
      try {
        content.innerHTML = '<div class="loading"></div>';
        const res = await fetch("blogs.json");
        blogs = await res.json();
        if (location.hash) {
          loadBlog(location.hash.substring(1));
        } else {
          showHome();
        }
      } catch (error) {
        content.innerHTML =
          "<p>Error loading blog list. Please check if blogs/blogs.json exists.</p>";
      }
    }

    async function loadBlog(blogId) {
      const blog = blogs.find((b) => b.id === blogId);
      if (!blog) {
        showHome();
        return;
      }

      try {
        content.innerHTML = '<div class="loading"></div>';
        const res = await fetch(blog.file);
        const text = await res.text();
        content.innerHTML = marked.parse(text);
      } catch (err) {
        content.innerHTML =
          "<p>Error loading blog post. Please check if the file exists.</p>";
      }
    }

    function showHome() {
      content.innerHTML = "<h2>Posts</h2><ul id='blog-index'></ul>";
      const ul = document.getElementById("blog-index");

      blogs.forEach((b) => {
        const li = document.createElement("li");
        const a = document.createElement("a");
        a.href = "#" + b.id;
        a.textContent = b.title;
        a.addEventListener("click", (e) => {
          e.preventDefault();
          loadBlog(b.id);
          history.pushState({id: b.id}, "", "#" + b.id);
        });
        li.appendChild(a);
        ul.appendChild(li);
      });
    }

    window.addEventListener("popstate", (e) => {
      if (e.state && e.state.id) {
        loadBlog(e.state.id);
      } else {
        showHome();
      }
    });

    let resizeTimeout;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = setTimeout(() => {
        buildNavbar();
      }, 250);
    });

    loadBlogList();

    async function loadBlog(blogId) {
      const blog = blogs.find((b) => b.id === blogId);
      if (!blog) {
        showHome();
        return;
      }

      try {
        content.innerHTML = '<div class="loading"></div>';
        const res = await fetch(blog.file);
        const text = await res.text();
        content.innerHTML = marked.parse(text);

        // Add Go Back button
        const backBtn = document.createElement("a");
        backBtn.href = "#";
        backBtn.textContent = "← Go Back";
        backBtn.className = "go-back";
        backBtn.addEventListener("click", (e) => {
          e.preventDefault();
          showHome();
          history.pushState({}, "", "#");
        });
        content.appendChild(backBtn);
      } catch (err) {
        content.innerHTML =
          "<p>Error loading blog post. Please check if the file exists.</p>";
      }
    }
    async function loadBlog(blogId) {
      const blog = blogs.find((b) => b.id === blogId);
      if (!blog) {
        showHome();
        return;
      }

      try {
        content.innerHTML = '<div class="loading"></div>';
        const res = await fetch(blog.file);
        const text = await res.text();
        content.innerHTML = marked.parse(text);

        // Add "Go Back" button
        const backBtn = document.createElement("a");
        backBtn.href = "#";
        backBtn.textContent = "← Go Back";
        backBtn.className = "go-back";
        backBtn.addEventListener("click", (e) => {
          e.preventDefault();
          showHome();
          history.pushState({}, "", "#");
        });
        content.appendChild(backBtn);

        // Add copy buttons to <pre>
        document.querySelectorAll("pre").forEach((block) => {
          const btn = document.createElement("button");
          btn.textContent = "Copy";
          btn.className = "copy-btn";
          btn.addEventListener("click", () => {
            const code = block.innerText;
            navigator.clipboard.writeText(code).then(() => {
              btn.textContent = "Copied!";
              setTimeout(() => (btn.textContent = "Copy"), 1500);
            });
          });
          block.appendChild(btn);
        });
      } catch (err) {
        content.innerHTML =
          "<p>Error loading blog post. Please check if the file exists.</p>";
      }
    }

  </script>
</body>

</html>
